CREATE TABLE IF NOT EXISTS public.coin_price(p_date date not null, price numeric(21, 10) not null, primary key(p_date));

Insert into public.coin_price(p_date, price) values('2021-05-04',670.4414804702);
Insert into public.coin_price(p_date, price) values('2021-05-05',670.4414804702);
Insert into public.coin_price(p_date, price) values('2021-05-06',652.8008801503);
Insert into public.coin_price(p_date, price) values('2021-05-07',586.8800724156);
Insert into public.coin_price(p_date, price) values('2021-05-08',942.3163623023);
Insert into public.coin_price(p_date, price) values('2021-05-09',1331.1772662167);
Insert into public.coin_price(p_date, price) values('2021-05-10',1087.9127022771);
Insert into public.coin_price(p_date, price) values('2021-05-11',1124.2193434545);
Insert into public.coin_price(p_date, price) values('2021-05-12',970.3578321601);
Insert into public.coin_price(p_date, price) values('2021-05-13',1002.3075562267);
Insert into public.coin_price(p_date, price) values('2021-05-14',1056.5735022249);
Insert into public.coin_price(p_date, price) values('2021-05-15',1551.2483109215);
Insert into public.coin_price(p_date, price) values('2021-05-16',1541.3675399634);
Insert into public.coin_price(p_date, price) values('2021-05-17',1441.2063425247);
Insert into public.coin_price(p_date, price) values('2021-05-18',1305.0773881347);
Insert into public.coin_price(p_date, price) values('2021-05-19',1297.9413965804);
Insert into public.coin_price(p_date, price) values('2021-05-20',919.4348704031);
Insert into public.coin_price(p_date, price) values('2021-05-21',1002.4085584194);
Insert into public.coin_price(p_date, price) values('2021-05-22',862.4836005609);
Insert into public.coin_price(p_date, price) values('2021-05-23',836.5741174571);
Insert into public.coin_price(p_date, price) values('2021-05-24',735.0866205858);
Insert into public.coin_price(p_date, price) values('2021-05-25',879.3876556636);
Insert into public.coin_price(p_date, price) values('2021-05-26',823.1552283467);
Insert into public.coin_price(p_date, price) values('2021-05-27',844.1357080240);
Insert into public.coin_price(p_date, price) values('2021-05-28',808.8421183522);
Insert into public.coin_price(p_date, price) values('2021-05-29',769.6617335883);
Insert into public.coin_price(p_date, price) values('2021-05-30',796.6568199860);
Insert into public.coin_price(p_date, price) values('2021-05-31',783.9487680779);
Insert into public.coin_price(p_date, price) values('2021-06-01',772.7819949343);
Insert into public.coin_price(p_date, price) values('2021-06-02',697.4419012922);
Insert into public.coin_price(p_date, price) values('2021-06-03',695.1171746349);
Insert into public.coin_price(p_date, price) values('2021-06-04',739.3695177914);
Insert into public.coin_price(p_date, price) values('2021-06-05',694.2747153021);
Insert into public.coin_price(p_date, price) values('2021-06-06',680.5926822452);
Insert into public.coin_price(p_date, price) values('2021-06-07',657.0555063718);
Insert into public.coin_price(p_date, price) values('2021-06-08',582.6089571164);
Insert into public.coin_price(p_date, price) values('2021-06-09',554.1670697944);
Insert into public.coin_price(p_date, price) values('2021-06-10',556.0232865692);
Insert into public.coin_price(p_date, price) values('2021-06-11',517.7727145953);
Insert into public.coin_price(p_date, price) values('2021-06-12',434.5130058982);
Insert into public.coin_price(p_date, price) values('2021-06-13',416.1846804309);
Insert into public.coin_price(p_date, price) values('2021-06-14',416.2896860209);
Insert into public.coin_price(p_date, price) values('2021-06-15',434.6780090971);
Insert into public.coin_price(p_date, price) values('2021-06-16',421.9817692773);
Insert into public.coin_price(p_date, price) values('2021-06-17',412.3009422071);
Insert into public.coin_price(p_date, price) values('2021-06-18',418.1792451331);
Insert into public.coin_price(p_date, price) values('2021-06-19',396.1396821606);
Insert into public.coin_price(p_date, price) values('2021-06-20',389.3910779625);
Insert into public.coin_price(p_date, price) values('2021-06-21',348.8013695032);
Insert into public.coin_price(p_date, price) values('2021-06-22',241.2670445021);
Insert into public.coin_price(p_date, price) values('2021-06-23',227.5004096145);
Insert into public.coin_price(p_date, price) values('2021-06-24',320.9508494477);
Insert into public.coin_price(p_date, price) values('2021-06-25',316.0405879336);
Insert into public.coin_price(p_date, price) values('2021-06-26',290.1429948493);
Insert into public.coin_price(p_date, price) values('2021-06-27',276.2121170328);
Insert into public.coin_price(p_date, price) values('2021-06-28',277.3874909460);
Insert into public.coin_price(p_date, price) values('2021-06-29',275.1933657925);
Insert into public.coin_price(p_date, price) values('2021-06-30',308.5540419285);
Insert into public.coin_price(p_date, price) values('2021-07-01',293.7224382766);
Insert into public.coin_price(p_date, price) values('2021-07-02',283.8936357906);
Insert into public.coin_price(p_date, price) values('2021-07-03',282.6186830529);
Insert into public.coin_price(p_date, price) values('2021-07-04',298.6824606209);
Insert into public.coin_price(p_date, price) values('2021-07-05',295.6119641792);
Insert into public.coin_price(p_date, price) values('2021-07-06',287.9643992207);
Insert into public.coin_price(p_date, price) values('2021-07-07',282.6273982728);
Insert into public.coin_price(p_date, price) values('2021-07-08',280.3371364105);
Insert into public.coin_price(p_date, price) values('2021-07-09',281.7466678368);
Insert into public.coin_price(p_date, price) values('2021-07-10',274.8659541716);
Insert into public.coin_price(p_date, price) values('2021-07-11',264.3957898898);
Insert into public.coin_price(p_date, price) values('2021-07-12',258.9515089094);
Insert into public.coin_price(p_date, price) values('2021-07-13',240.1326320252);
Insert into public.coin_price(p_date, price) values('2021-07-14',229.9827942709);
Insert into public.coin_price(p_date, price) values('2021-07-15',232.9624419917);
Insert into public.coin_price(p_date, price) values('2021-07-16',217.3317704063);
Insert into public.coin_price(p_date, price) values('2021-07-17',209.1185917670);
Insert into public.coin_price(p_date, price) values('2021-07-18',210.3730239931);
Insert into public.coin_price(p_date, price) values('2021-07-19',208.0039014480);
Insert into public.coin_price(p_date, price) values('2021-07-20',184.5501984522);
Insert into public.coin_price(p_date, price) values('2021-07-21',177.0847801703);
Insert into public.coin_price(p_date, price) values('2021-07-22',186.8464378668);
Insert into public.coin_price(p_date, price) values('2021-07-23',181.2849888730);
Insert into public.coin_price(p_date, price) values('2021-07-24',179.6200793627);
Insert into public.coin_price(p_date, price) values('2021-07-25',188.2646609712);
Insert into public.coin_price(p_date, price) values('2021-07-26',185.4912842301);
Insert into public.coin_price(p_date, price) values('2021-07-27',195.0804087857);
Insert into public.coin_price(p_date, price) values('2021-07-28',190.8227150883);
Insert into public.coin_price(p_date, price) values('2021-07-29',191.3634545135);
Insert into public.coin_price(p_date, price) values('2021-07-30',200.6713164342);
Insert into public.coin_price(p_date, price) values('2021-07-31',284.5432055648);
Insert into public.coin_price(p_date, price) values('2021-08-01',260.1035020000);
Insert into public.coin_price(p_date, price) values('2021-08-02',231.3533108662);
Insert into public.coin_price(p_date, price) values('2021-08-03',227.2614339692);
Insert into public.coin_price(p_date, price) values('2021-08-04',221.4365660029);
Insert into public.coin_price(p_date, price) values('2021-08-05',232.4594523055);
Insert into public.coin_price(p_date, price) values('2021-08-06',230.7922049075);
Insert into public.coin_price(p_date, price) values('2021-08-07',255.6336400931);
Insert into public.coin_price(p_date, price) values('2021-08-08',268.1885645921);
Insert into public.coin_price(p_date, price) values('2021-08-09',243.8687535956);
Insert into public.coin_price(p_date, price) values('2021-08-10',263.0401096271);
Insert into public.coin_price(p_date, price) values('2021-08-11',256.5535085374);
Insert into public.coin_price(p_date, price) values('2021-08-12',267.5937104763);
Insert into public.coin_price(p_date, price) values('2021-08-13',269.8012210359);
Insert into public.coin_price(p_date, price) values('2021-08-14',279.0348154596);
Insert into public.coin_price(p_date, price) values('2021-08-15',270.8074671536);
Insert into public.coin_price(p_date, price) values('2021-08-16',266.5343774681);
Insert into public.coin_price(p_date, price) values('2021-08-17',263.6594582286);
Insert into public.coin_price(p_date, price) values('2021-08-18',248.4124096585);
Insert into public.coin_price(p_date, price) values('2021-08-19',243.7430361842);
Insert into public.coin_price(p_date, price) values('2021-08-20',245.2863001649);
Insert into public.coin_price(p_date, price) values('2021-08-21',255.3782523686);
Insert into public.coin_price(p_date, price) values('2021-08-22',254.8959881714);
Insert into public.coin_price(p_date, price) values('2021-08-23',256.4807943556);
Insert into public.coin_price(p_date, price) values('2021-08-24',258.7018482153);
Insert into public.coin_price(p_date, price) values('2021-08-25',256.8283408415);
Insert into public.coin_price(p_date, price) values('2021-08-26',256.2650940421);
Insert into public.coin_price(p_date, price) values('2021-08-27',246.3092869180);
Insert into public.coin_price(p_date, price) values('2021-08-28',254.0160946928);
Insert into public.coin_price(p_date, price) values('2021-08-29',244.7153590976);
Insert into public.coin_price(p_date, price) values('2021-08-30',242.7512224812);
Insert into public.coin_price(p_date, price) values('2021-08-31',223.4515515326);
Insert into public.coin_price(p_date, price) values('2021-09-01',222.4037068262);
Insert into public.coin_price(p_date, price) values('2021-09-02',224.1455322597);
Insert into public.coin_price(p_date, price) values('2021-09-03',223.1294192477);
Insert into public.coin_price(p_date, price) values('2021-09-04',219.7968925018);
Insert into public.coin_price(p_date, price) values('2021-09-05',225.1471820081);
Insert into public.coin_price(p_date, price) values('2021-09-06',261.7189262811);
Insert into public.coin_price(p_date, price) values('2021-09-07',255.2461268754);
Insert into public.coin_price(p_date, price) values('2021-09-08',223.1086772286);
Insert into public.coin_price(p_date, price) values('2021-09-09',215.6622668646);
Insert into public.coin_price(p_date, price) values('2021-09-10',222.7360254378);
Insert into public.coin_price(p_date, price) values('2021-09-11',209.0297348684);
Insert into public.coin_price(p_date, price) values('2021-09-12',213.0537127652);
Insert into public.coin_price(p_date, price) values('2021-09-13',213.0143387297);
Insert into public.coin_price(p_date, price) values('2021-09-14',208.8131933646);
Insert into public.coin_price(p_date, price) values('2021-09-15',215.8939210458);
Insert into public.coin_price(p_date, price) values('2021-09-16',214.1513253325);
Insert into public.coin_price(p_date, price) values('2021-09-17',213.7110757955);
Insert into public.coin_price(p_date, price) values('2021-09-18',216.2324801676);
Insert into public.coin_price(p_date, price) values('2021-09-19',212.8406280127);
Insert into public.coin_price(p_date, price) values('2021-09-20',212.3436051121);
Insert into public.coin_price(p_date, price) values('2021-09-21',197.6988776247);
Insert into public.coin_price(p_date, price) values('2021-09-22',200.1881307144);
Insert into public.coin_price(p_date, price) values('2021-09-23',210.2928815731);
Insert into public.coin_price(p_date, price) values('2021-09-24',206.7529897164);
Insert into public.coin_price(p_date, price) values('2021-09-25',191.0085788020);
Insert into public.coin_price(p_date, price) values('2021-09-26',185.8402343446);
Insert into public.coin_price(p_date, price) values('2021-09-27',158.4735131788);
Insert into public.coin_price(p_date, price) values('2021-09-28',158.8137421293);
Insert into public.coin_price(p_date, price) values('2021-09-29',143.8636457622);
Insert into public.coin_price(p_date, price) values('2021-09-30',146.7610018118);
Insert into public.coin_price(p_date, price) values('2021-10-01',149.7850047299);
Insert into public.coin_price(p_date, price) values('2021-10-02',164.6353172930);
Insert into public.coin_price(p_date, price) values('2021-10-03',162.5865786725);
Insert into public.coin_price(p_date, price) values('2021-10-04',165.0661333359);
Insert into public.coin_price(p_date, price) values('2021-10-05',164.4467395351);
Insert into public.coin_price(p_date, price) values('2021-10-06',176.4707987051);
Insert into public.coin_price(p_date, price) values('2021-10-07',168.5238944679);
Insert into public.coin_price(p_date, price) values('2021-10-08',167.1238896689);
Insert into public.coin_price(p_date, price) values('2021-10-09',173.9262225095);
Insert into public.coin_price(p_date, price) values('2021-10-10',168.4628148355);
Insert into public.coin_price(p_date, price) values('2021-10-11',158.3347775006);
Insert into public.coin_price(p_date, price) values('2021-10-12',161.7911409901);
Insert into public.coin_price(p_date, price) values('2021-10-13',154.9851392029);
Insert into public.coin_price(p_date, price) values('2021-10-14',155.3795262888);
Insert into public.coin_price(p_date, price) values('2021-10-15',158.9812929940);
Insert into public.coin_price(p_date, price) values('2021-10-16',158.0861284009);
Insert into public.coin_price(p_date, price) values('2021-10-17',163.1536451350);
Insert into public.coin_price(p_date, price) values('2021-10-18',155.2606279383);
Insert into public.coin_price(p_date, price) values('2021-10-19',152.6424479646);
Insert into public.coin_price(p_date, price) values('2021-10-20',150.9047412551);
Insert into public.coin_price(p_date, price) values('2021-10-21',152.6838021862);
Insert into public.coin_price(p_date, price) values('2021-10-22',156.1051663450);
Insert into public.coin_price(p_date, price) values('2021-10-23',154.5182602162);
Insert into public.coin_price(p_date, price) values('2021-10-24',151.9494544108);
Insert into public.coin_price(p_date, price) values('2021-10-25',152.3981690283);
Insert into public.coin_price(p_date, price) values('2021-10-26',151.3842176187);
Insert into public.coin_price(p_date, price) values('2021-10-27',148.3471746169);
Insert into public.coin_price(p_date, price) values('2021-10-28',135.6393804278);
Insert into public.coin_price(p_date, price) values('2021-10-29',136.7739753824);
Insert into public.coin_price(p_date, price) values('2021-10-30',137.7266756725);
Insert into public.coin_price(p_date, price) values('2021-10-31',133.7413963158);
Insert into public.coin_price(p_date, price) values('2021-11-01',145.4568209560);
Insert into public.coin_price(p_date, price) values('2021-11-02',143.8747294601);
Insert into public.coin_price(p_date, price) values('2021-11-03',154.3169558864);
Insert into public.coin_price(p_date, price) values('2021-11-04',165.7928117976);
Insert into public.coin_price(p_date, price) values('2021-11-05',214.1980633481);
Insert into public.coin_price(p_date, price) values('2021-11-06',190.6121118179);
Insert into public.coin_price(p_date, price) values('2021-11-07',191.7316152608);
Insert into public.coin_price(p_date, price) values('2021-11-08',190.0607120033);
Insert into public.coin_price(p_date, price) values('2021-11-09',185.1342112896);
Insert into public.coin_price(p_date, price) values('2021-11-10',173.2006093210);
Insert into public.coin_price(p_date, price) values('2021-11-11',167.2065885262);
Insert into public.coin_price(p_date, price) values('2021-11-12',172.5602585168);
Insert into public.coin_price(p_date, price) values('2021-11-13',165.1551081109);
Insert into public.coin_price(p_date, price) values('2021-11-14',164.2199845267);
Insert into public.coin_price(p_date, price) values('2021-11-15',164.3401862249);
Insert into public.coin_price(p_date, price) values('2021-11-16',155.8812958871);
Insert into public.coin_price(p_date, price) values('2021-11-17',143.7344421425);
Insert into public.coin_price(p_date, price) values('2021-11-18',147.9832740449);
Insert into public.coin_price(p_date, price) values('2021-11-19',136.3315798284);
Insert into public.coin_price(p_date, price) values('2021-11-20',143.3239600551);
Insert into public.coin_price(p_date, price) values('2021-11-21',143.7072074688);
Insert into public.coin_price(p_date, price) values('2021-11-22',145.7575311488);
Insert into public.coin_price(p_date, price) values('2021-11-23',142.0710116024);
Insert into public.coin_price(p_date, price) values('2021-11-24',141.0027580191);
Insert into public.coin_price(p_date, price) values('2021-11-25',135.9539285189);
Insert into public.coin_price(p_date, price) values('2021-11-26',137.7208490468);
Insert into public.coin_price(p_date, price) values('2021-11-27',131.3970443854);
Insert into public.coin_price(p_date, price) values('2021-11-28',133.8739883906);
Insert into public.coin_price(p_date, price) values('2021-11-29',138.6843343252);
Insert into public.coin_price(p_date, price) values('2021-11-30',138.9680035028);
Insert into public.coin_price(p_date, price) values('2021-12-01',136.8345939772);
Insert into public.coin_price(p_date, price) values('2021-12-02',132.1859699447);
Insert into public.coin_price(p_date, price) values('2021-12-03',126.1205132849);
Insert into public.coin_price(p_date, price) values('2021-12-04',121.9261620339);
Insert into public.coin_price(p_date, price) values('2021-12-05',106.8122292288);
Insert into public.coin_price(p_date, price) values('2021-12-06',104.3551224758);
Insert into public.coin_price(p_date, price) values('2021-12-07',107.5992631357);
Insert into public.coin_price(p_date, price) values('2021-12-08',104.1834448136);
Insert into public.coin_price(p_date, price) values('2021-12-09',106.6739353569);
Insert into public.coin_price(p_date, price) values('2021-12-10',106.2370179083);
Insert into public.coin_price(p_date, price) values('2021-12-11',104.3044925966);
Insert into public.coin_price(p_date, price) values('2021-12-12',101.9845031323);
Insert into public.coin_price(p_date, price) values('2021-12-13',100.7744481028);
Insert into public.coin_price(p_date, price) values('2021-12-14',92.6365297842);

CREATE OR REPLACE PROCEDURE public.save_coin_price(
	IN pDate date,
	IN price numeric(21, 10)
    )
LANGUAGE 'plpgsql'
AS $BODY$

begin

CREATE TEMP TABLE bothDatesP (
   dDate date
) ON COMMIT DROP;

insert into bothDatesP(dDate) values(pDate);
insert into bothDatesP(dDate) values(pDate + 1);

INSERT INTO public.coin_price (
    p_date,
    price
    )
Select 
    dDate,
    price
From
	bothDatesP
ON CONFLICT (p_date) 
DO UPDATE SET 
    price = EXCLUDED.price;

end;
$BODY$;
